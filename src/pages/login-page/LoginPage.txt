<template>
  <q-page class="row items-center justify-center login-page">
    <q-card class="login-container">
      <!-- Desktop Layout -->
      <div class="row no-wrap full-height hidden-xs hidden-sm">
        <!-- ‡∏ã‡πâ‡∏≤‡∏¢: ‡πÇ‡∏•‡πÇ‡∏Å‡πâ -->
        <div class="col-12 left-side flex flex-center column">
          <div class="logo-section text-center q-mx-md">
            <div class="icon-container q-mb-md">
              <q-icon name="school" size="80px" color="white" />
            </div>
            <div class="text-h4 text-white q-mb-xs brand-title">C.E.T.H. Informatics<br /></div>

            <div class="text-subtitle1 text-white brand-subtitle">
              ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏£‡∏™‡∏ô‡πÄ‡∏ó‡∏®‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏≠‡∏ö‡∏£‡∏°‡∏™‡∏´‡∏Å‡∏¥‡∏à‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô
            </div>
            <q-separator class="q-mt-md" style="background-color: aliceblue" />
          </div>

          <!-- Decorative circles -->
          <div class="decorative-circles">
            <div class="circle circle-1"></div>
            <div class="circle circle-2"></div>
            <div class="circle circle-3"></div>
          </div>
          <div class="q-mt-md text-white">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>

          <div class="q-mt-md">
            <q-btn
              label="‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Google"
              color="white"
              text-color="grey-8"
              class="full-width google-login-btn q-mb-md"
              unelevated
              no-caps
              :loading="isGoogleLoggingIn"
              :disable="isGoogleLoggingIn || isLoggingIn"
              @click="handleGoogleLogin"
              data-testid="google-login-submit"
            >
              <template v-slot:default>
                <div class="row items-center no-wrap">
                  <img
                    src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c1/Google_%22G%22_logo.svg/768px-Google_%22G%22_logo.svg.png"
                    alt="Google"
                    class="google-icon q-ml-sm"
                  />
                </div>
              </template>
            </q-btn>
          </div>
          <div class="security-badge text-center q-mt-md">
            <q-icon name="shield" color="white" size="18px" />
            <span class="text-body2 text-white q-ml-xs">‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏î‡πâ‡∏ß‡∏¢ Google</span>
          </div>
          <div class="text-center q-mt-md">
            <div class="text-caption text-grey-6">¬© 2025 Cooperative Education System</div>
          </div>
        </div>
      </div>

      <!-- Mobile Layout -->
    </q-card>
  </q-page>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { useRoute } from 'vue-router'
// import RecoverPassword from './RecoverPassword.vue'
import AuthService from 'src/services/auth'

const route = useRoute()

const isLoggingIn = ref(false)
const isGoogleLoggingIn = ref(false)

// Handle redirect query parameter on mount
onMounted(() => {
  const redirect = route.query.redirect as string
  if (redirect) {
    console.log('üîÑ Redirect detected from query parameter:', redirect)
    localStorage.setItem('redirectAfterLogin', redirect)
  }

  // Check if there's a stored redirect
  const storedRedirect = localStorage.getItem('redirectAfterLogin')
  if (storedRedirect) {
    console.log('üîÑ Stored redirect found:', storedRedirect)
  }
})

// Google Login Handler
const handleGoogleLogin = async () => {
  try {
    isGoogleLoggingIn.value = true

    await AuthService.loginWithGoogle()
  } finally {
    isGoogleLoggingIn.value = false
  }
}
</script>

<style scoped>
.login-page {
  /* background: linear-gradient(135deg, #14279b 0%, #233174 50%, #14279b 100%); */
  background: linear-gradient(135deg, #4a5fbf 0%, #2e3f80 60%, #1a2b5c 100%);
  min-height: 100vh;
  padding: 2rem;
}

.login-container {
  width: 900px;
  max-width: 95vw;
  height: 600px;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
  animation: slideUp 0.8s ease-out;
}

@keyframes slideUp {
  0% {
    opacity: 0;
    transform: translateY(30px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Desktop Left Side */
.left-side {
  background: linear-gradient(135deg, #14279b 0%, #14279b 60%, #14279b 100%);
  position: relative;
  overflow: hidden;
}

.logo-section {
  z-index: 2;
  position: relative;
}

.icon-container {
  background: rgba(255, 255, 255, 0.15);
  border-radius: 50%;
  padding: 30px;
  display: inline-block;
  backdrop-filter: blur(10px);
  border: 2px solid rgba(255, 255, 255, 0);
  animation: float 3s ease-in-out infinite;
}

@keyframes float {
  0%,
  100% {
    transform: translateY(0px);
  }
  50% {
    transform: translateY(-10px);
  }
}

.brand-title {
  font-weight: 600;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  line-height: 1.2;
}

.brand-subtitle {
  opacity: 0.9;
  font-weight: 400;
}

/* Decorative Circles */
.decorative-circles {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
}

.circle {
  position: absolute;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.08);
  animation: circleFloat 8s infinite linear;
}

.circle-1 {
  width: 100px;
  height: 100px;
  top: 10%;
  left: 5%;
}

.circle-2 {
  width: 150px;
  height: 150px;
  top: 70%;
  right: 10%;
}

.circle-3 {
  width: 80px;
  height: 80px;
  bottom: 20%;
  left: 70%;
}

@keyframes circleFloat {
  0%,
  100% {
    transform: translateY(0px) rotate(0deg);
    opacity: 0.6;
  }
  50% {
    transform: translateY(-20px) rotate(180deg);
    opacity: 0.3;
  }
}

/* Desktop Right Side */
.right-side {
  background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
  padding: 2rem;
}

.login-form-container {
  width: 100%;
  max-width: 400px;
}

.login-title {
  color: #2e3f80;
  font-weight: 600;
  margin-bottom: 1rem;
}

.login-divider {
  width: 50px;
  height: 3px;
  background: linear-gradient(90deg, #4a5fbf, #2e3f80);
  border-radius: 2px;
  margin: 0 auto;
}

.login-input {
  margin-bottom: 1rem;
}

.login-input .q-field__control {
  border-radius: 8px;
  background: #fafbff;
}

.login-btn {
  height: 48px;
  border-radius: 8px;
  font-weight: 600;
  font-size: 16px;
  background: linear-gradient(135deg, #4a5fbf 0%, #2e3f80 100%);
}

.forgot-password-btn {
  font-size: 14px;
  text-decoration: none;
}



/* Responsive */

/* Focus States */
.login-input .q-field--focused .q-field__control {
  border-color: #4a5fbf;
  box-shadow: 0 0 0 1px #4a5fbf;
}

/* Hover Effects */
.login-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(74, 95, 191, 0.3);
}

.forgot-password-btn:hover {
  text-decoration: underline;
}

/* Google Login Styles */
.google-login-btn {
  height: 48px;
  border-radius: 8px;
  font-weight: 500;
  font-size: 16px;
  border: 1px solid #dadce0;
  background: #ffffff;
  transition: all 0.2s ease;
}

.google-login-btn:hover {
  background: #f8f9fa;
  border-color: #c1c7cd;
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.google-icon {
  width: 20px;
  height: 20px;
}

/* Divider Styles */
.divider-container {
  display: flex;
  align-items: center;
  width: 100%;
}

.divider-line {
  flex: 1;
  height: 1px;
  background: #e0e0e0;
}

.divider-text {
  padding: 0 16px;
  color: #666;
  font-size: 14px;
  background: #ffffff;
}
/* Security Badge */
.security-badge {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

/* Footer Text */
</style>
